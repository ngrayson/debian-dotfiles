#
# Hyprland Idle Management Configuration
# ======================================
#
# PURPOSE:
#   Configures idle timeout actions for screensaver, locking, screen off,
#   suspend, and hibernate. Manages power-saving and security features.
#
# IDLE TIMEOUTS:
#   1. Screensaver (150s / 2.5min):
#      - Uses screensaver-with-media-check.sh which prevents activation if media is playing
#      - Timer resets automatically when media is detected
#   2. Lock Screen (300s / 5min):
#      - Locks the screen via loginctl lock-session
#   3. Screen Off (600s / 10min):
#      - Turns off displays via hyprctl dispatch dpms off
#      - Restores brightness on resume
#   4. Suspend (1800s / 30min):
#      - Suspends to RAM via systemctl suspend
#   5. Hibernate (3600s / 60min):
#      - Hibernates to disk via systemctl hibernate
#      - Requires swap partition/file (not zram)
#
# MEDIA DETECTION:
#   Only the screensaver timeout checks for media activity. Other actions
#   (lock, screen off, suspend, hibernate) proceed regardless of media state.
#   This ensures security (locking) and power management (suspend/hibernate)
#   are not prevented by media playback.
#
# INTEGRATION:
#   - Started by: ~/.config/hypr/autostart.conf (exec-once = hypridle)
#   - Uses scripts: ~/.config/hypr/screensaver-with-media-check.sh
#   - Detection script: ~/.config/hypr/check-media-playing.sh
#   - Lock command: omarchy-lock-screen (includes 1Password integration)
#

general {
    lock_cmd = omarchy-lock-screen                         # lock screen and 1password
    before_sleep_cmd = loginctl lock-session               # lock before suspend.
    after_sleep_cmd = hyprctl dispatch dpms on             # to avoid having to press a key twice to turn on the display.
    inhibit_sleep = 3                                      # wait until screen is locked
}

listener {
    timeout = 150                                             # 2.5min
    on-timeout = ~/.config/hypr/screensaver-with-media-check.sh # start screensaver (checks media and resets timer if playing)
}

listener {
    timeout = 300                      # 5min
    on-timeout = loginctl lock-session # lock screen when timeout has passed
}

listener {
    timeout = 600                                            # 10min - screen off when timeout has passed
    on-timeout = hyprctl dispatch dpms off                   # screen off when timeout has passed
    on-resume = hyprctl dispatch dpms on && brightnessctl -r # screen on when activity is detected
}

listener {
    timeout = 1800                                           # 30min - suspend to RAM
    on-timeout = systemctl suspend
}

listener {
    timeout = 3600                                           # 60min - hibernate (requires swap partition/file, not zram)
    on-timeout = systemctl hibernate
}
