#
# Hyprland Idle Management Configuration
# ======================================
#
# PURPOSE:
#   Configures idle timeout actions for screensaver, locking, screen off,
#   suspend, and hibernate. Manages power-saving and security features.
#
# IDLE TIMEOUTS:
#   1. Screensaver (150s / 2.5min):
#      - Uses screensaver-with-media-check.sh which prevents activation if media is playing
#      - Timer resets automatically when media is detected
#   2. Lock Screen (300s / 5min):
#      - Checks for media/fullscreen/games before locking
#      - Locks the screen via loginctl lock-session only if idle not inhibited
#   3. Screen Off (600s / 10min):
#      - Checks for media/fullscreen/games before turning off screen
#      - Turns off displays via hyprctl dispatch dpms off only if idle not inhibited
#   4. Suspend (1800s / 30min):
#      - Suspends to RAM via systemctl suspend
#   5. Hibernate (3600s / 60min):
#      - Hibernates to disk via systemctl hibernate
#      - Requires swap partition/file (not zram)
#
# IDLE INHIBITION:
#   The check-idle-inhibited.sh script prevents idle actions when:
#   - Media is playing (Spotify, YouTube, etc. via MPRIS)
#   - Any window is in fullscreen mode
#   - Games are running
#
#   Scripts location: ~/.local/bin/hypridle-checks/
#   Diagnostic tool: ~/.local/bin/hypridle-status.sh
#
# INTEGRATION:
#   - Started by: ~/.config/hypr/autostart.conf (exec-once = hypridle)
#   - Uses scripts: ~/.config/hypr/screensaver-with-media-check.sh
#   - Detection scripts: ~/.local/bin/hypridle-checks/
#   - Lock command: omarchy-lock-screen (includes 1Password integration)
#

general {
    lock_cmd = omarchy-lock-screen                         # lock screen and 1password
    before_sleep_cmd = loginctl lock-session               # lock before suspend.
    after_sleep_cmd = hyprctl dispatch dpms on             # to avoid having to press a key twice to turn on the display.
    inhibit_sleep = 3                                      # wait until screen is locked
}

listener {
    timeout = 150                                             # 2.5min
    on-timeout = ~/.config/hypr/screensaver-with-media-check.sh # start screensaver (checks media and resets timer if playing)
}

# Lock screen listener - checks for media/fullscreen/games before locking
listener {
    timeout = 300                                             # 5min
    # Only lock if idle is not inhibited (check script returns non-zero)
    # If check returns 0 (inhibited), lock command won't execute
    on-timeout = ~/.local/bin/hypridle-checks/check-idle-inhibited.sh || loginctl lock-session
}

# Screen off listener - checks for media/fullscreen/games before turning off screen
listener {
    timeout = 600                                             # 10min - screen off when timeout has passed
    # Only turn off screen if idle is not inhibited
    on-timeout = ~/.local/bin/hypridle-checks/check-idle-inhibited.sh || hyprctl dispatch dpms off
    on-resume = hyprctl dispatch dpms on && brightnessctl -r # screen on when activity is detected
}

listener {
    timeout = 1800                                           # 30min - suspend to RAM
    on-timeout = systemctl suspend
}

listener {
    timeout = 3600                                           # 60min - hibernate (requires swap partition/file, not zram)
    on-timeout = systemctl hibernate
}
